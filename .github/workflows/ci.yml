name: Calculator CI - Fast

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]

jobs:
  windows-msvc:
    name: Windows MSVC
    runs-on: windows-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Build with MSVC
        run: |
          mkdir build
          cd build
          cmake .. -G "Visual Studio 17 2022"
          cmake --build . --config Release
          cmake --build . --target validate_all

      - name: Run tests
        run: |
          if exist "calculator_tests" (
            cd calculator_tests
            python main.py
          )

  windows-mingw:
    name: Windows MinGW
    runs-on: windows-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Install MinGW
        run: choco install mingw -y

      - name: Build with MinGW
        run: |
          mkdir build
          cd build
          cmake .. -G "MinGW Makefiles"
          cmake --build .
          cmake --build . --target validate_all

      - name: Run tests
        run: |
          if exist "calculator_tests" (
            cd calculator_tests
            python main.py
          )

  linux-gcc:
    name: Linux GCC
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Install tools
        run: |
          sudo apt-get update
          sudo apt-get install -y build-essential cmake

      - name: Build with GCC
        run: |
          mkdir build
          cd build
          cmake .. -G "Unix Makefiles"
          cmake --build .
          cmake --build . --target validate_all

      - name: Run tests
        run: |
          if [ -d "calculator_tests" ]; then
            cd calculator_tests
            python main.py
          fi